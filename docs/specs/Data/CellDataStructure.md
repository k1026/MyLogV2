# 2. Cellデータ構造

## 2.1 定義
アプリケーションのデータの基本単位を「Cell（セル）」と呼びます。
データベースのレコードはCellを単位に記録し、Cellのデータメンバがカラムになります。

## 2.2 Cellの思想
Cellの役割は記録の保存であり、シンプルながら多彩な振る舞いができる構造を重視している。

## 2.3 メンバ定義
Cellはクラスにより管理され、以下のデータメンバを持っています。シンプルさから情報の多くは文字列で管理されます。

| プロパティ名 | DBキー | 型 | 説明 |
| --- | --- | --- | --- |
| `id` | `I` | string | `[Unix timestamp in ms]-[5-digit random uppercase alphanumeric]`のフォーマットでCellを一意に識別します。ID後半は5桁のランダムな大文字英数字。 |
| `attribute` | `A` | enum | Cellの属性 (`Card`, `Time`, `Text`, `Task`)。`CellAttribute` enumとして定義される。 |
| `name` | `N` | string | Cellの名前(Cellタイトル) 。属性によって制限がある。 |
| `value` | `V` | string | Cellの記録する値。属性によって制限がある。 |
| `geo` | `G` | string \| null | Cell作成時の位置情報（緯度 経度 高度 の順で値スペース区切り）。取得不可時は `null`。 |
| `remove` | `R` | string \| null | Cellの除外判定。除外されている場合はUNIXミリ秒のタイムスタンプを記録、そうでない場合は `null`。 |

### 2.3.1 ID生成規則
Cell IDは以下の形式で生成されます：
- フォーマット: `[13桁のUNIXタイムスタンプ]-[5桁のランダム大文字英数字]`
- 正規表現: `/^\d{13}-[A-Z0-9]{5}$/`
- ID前半から生成時間（ミリ秒単位）を復元可能です。

### 2.3.2 位置情報 (geo) の自動取得
`geo` はインスタンス生成時に自動的に記録されます。
- コンストラクタ呼び出し時に `geo` が `undefined` の場合、`LocationService` を通じて現在の位置情報を自動取得します。
- DBから読み込まれた値（`null` を含む）がある場合は、その値を保持します。

## 2.4 バリデーション
`Zod` を使用した `CellSchema` により、データの整合性を検証します。
- 全てのプロパティの型チェック
- IDのフォーマットチェック

## 2.5 属性ごとの定義と挙動

### 2.5.1 Cardセル
- **定義**: 他のCellをグループ化（パッケージ化）するための特殊なCell。
- **attribute**: `Card`
- **name**: "Card"で固定（推奨）。
- **value**: カードに含まれる子Cellの `id` をスペース区切りで記録する。
- **挙動**: 
    - `addCellId(childId)`: 既存のIDリストの末尾に、重複を許容せず（ロジック上は追加のみだが、フィルタリングで空文字を除去）追加する。
    - `removeCellId(childId)`: 指定されたIDをリストから除去する。

### 2.5.2 Timeセル
- **定義**: 時刻情報を保持するためのセル。
- **attribute**: `Time`
- **name**: デフォルトでは "Time" を入力。
- **value**: UNIXミリ秒を文字列で保持。生成時に指定がない場合は現在のタイムスタンプが設定される。
- **挙動**: UIに記録されている時間を表示・編集する。

### 2.5.3 Textセル
- **定義**: 任意のテキスト情報を保持するためのセル。
- **attribute**: `Text`
- **name**: 任意（空文字可）。
- **value**: 任意の文字列(空文字列可)。
- **挙動**: テキストデータの記録と操作。

### 2.5.4 Taskセル
- **定義**: タスク情報とその完了状態を管理するためのセル。
- **attribute**: `Task`
- **name**: タスク内容を表す任意の文字列(空文字可)。
- **value**: 完了時には完了時刻のUNIXミリ秒を記録し、未完了状態は空文字列で表現する。
- **挙動**: 値の有無で「完了/未完了」を判定する。

