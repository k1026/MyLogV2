# 15 フィルタ機能仕様書

## 15.1 概要
MyLogのメイン画面でカードを条件に基づいて絞り込む機能。フッターのフィルタボタンからアクセスし、専用のダイアログで条件を設定する。

## 15.2 UI・インターフェース

### 15.2.1 フィルタボタン（フッター）
- **場所**: フッターの中央セクション
- **機能**：フィルタダイアログによりフィルタ条件を設定し、カードリストUIに表示するべきカードを制御する

### 15.2.2 フィルタ設定ダイアログ
- **起動**: メイン画面のフッターのフィルタボタンタップ
  - フィルタダイアログの起動時点ではフィルタリングは実行しない。
- **構成要素**:
  - **属性選択ボタン**:
    - 表示対象とする属性（Text, Taskなど）を選択。
    - `Remove`ボタンを選択すると、論理削除（remove: true）された項目も含めて検索・表示する。
  - **キーワード抽出フィルタ**:
    - 入力欄: 検索したいキーワードを入力（複数キーワードをスペース区切りで指定可能）。
    - ターゲット切り替えボタン: 「両方」「名前」「値」をサイクル切り替え。
  - **キーワード除外フィルタ**:
    - 入力欄: 除外したいキーワードを入力。
    - ターゲット切り替えボタン: 「両方」「名前」「値」をサイクル切り替え。
  - **期間フィルタ**:
    - 開始日（date-from）と終了日（date-to）を指定。
  - **適用ボタン**:
    - **リセットボタン**: すべての条件をデフォルト（属性: Text, Taskのみ、キーワード空、期間なし）に戻す。
    - **適用ボタン**: 設定を保存し、ダイアログを閉じてリストを再描画する。

### 15.2.3 デフォルト設定
- **属性**: `['Text', 'Task']`
- **キーワード**: 空
- **期間**: 指定なし
- **除外済み項目**: 含めない
- **有効状態**: `enabled: false`

### 15.2.4 キーワードの強調表示
- **適用**：キーワード抽出フィルタに一致するテキストを強調表示する。
- **対象**：カードUIのプレビューテキスト、セルUIのテキスト部分で
- **強調表示**：一致するテキスト部分の背景を黄色に変更する
- **解除**：フィルタから抽出キーワードが削除されたら該当するテキストの強調表示も解除する

## 15.3 フィルタリングプロセス (`filterCards`)
1. **無効時の挙動**: フィルタが無効（`enabled: false`）であっても、`remove: true`のカードは常に非表示となる。
2. **マッチング判定 (`matchesCard`)**:
   - **除外済みチェック**: `includeRemoved`がfalseかつカードが`remove: true`ならマッチしない。
   - **サブセル構成**: カードに含まれるサブセルをすべて取得。
   - **属性フィルタ**: 選択された属性（Text/Task等）を1つ以上持つサブセルが含まれているか確認。含まれない場合は除外。
   - **期間フィルタ**: 条件に合致する属性を持つセルのうち、IDのタイムスタンプが指定期間内のものが1つ以上あるか確認。
   - **キーワード抽出**:
     - 空白区切りの各キーワードのいずれかが、対象となるサブセルの「名前」または「値」に含まれているか確認。
   - **キーワード除外**:
     - 除外キーワードのいずれかが、対象となるサブセルに含まれている場合は、そのカードを除外する。

## 15.4 データ永続化
- フィルタ設定は現在メモリ内のみで保持され、アプリの再起動（ページリロード）でデフォルトにリセットされる。
- ※ビューモード（リスト/グリッド）やソート順とは異なり、`localStorage`には保存されない。
