# 5. カードUI (Card UI)

カードはユーザーのデータ操作の基本単位であり、複数のCellを束ねるコンテナとして機能します。

# レイアウト
- **[全体]**：垂直 (Card List内の一項目として配置)
  - **[ヘッダー]**：水平 (配置：上下・左右に展開)
    - 🏷️ タイトル (通常時のみ。左側配置)
    - 📅 生成日時 (通常時のみ。右側配置)
    - 🛠️ カードツールバー (展開時のみ。右側配置)
    - ❌ 閉じるボタン (展開時のみ。右端配置)
  - **[ボディ]**：垂直 (展開時のみ)
    - 📋 セルリスト (垂直並び)
    - **[追加エリア]**：固定 (右下)
      - ➕ セル追加ボタン (Card FAB)
      - 🎡 属性選択メニュー (Pie Menu) - 展開時のみ

# 共通仕様
(カードコンテナ全体に関わる共通のデザイン。個別仕様「カード本体」にて詳細を記述)

# カード本体
**名称**：カード本体
**種類**：コンテナ
**用途**：複数のセルを統合し、リレーションの基本単位として機能。展開・折りたたみによる情報整理。
**形状**：角丸（rounded-[12px]）、枠線なし、インライン展開。
**寸法**：パディング（通常時）縦 6px, 横 12px (px-[12px] py-[6px])、パディング（展開時）12px (p-[12px])。幅は画面または親コンテナに追従。
**文字**：タイトル（折りたたみ時）はボールド・大（text-lg）、生成日時は小（text-xs）。
**色彩**：
  - 背景：レア度平均に基づく線形グラデーション（135deg）。
  - 通常時：bg-white/5、hover:bg-white/10。
  - 展開時：bg-white/10。
  - 除外時：bg-gray-500/20。
**装飾**：
  - シャドウ（shadow-sm）。
  - 展開時：バックドロップブラ―（backdrop-blur-md）とリング（ring-2 ring-white/20）を適用。
**配置**：縦並び（flex-col）。通常時はタイトルと生成日時を両端に配置。
**状態**：
  - 通常（Collapsed）：タイトル、生成日時、背景グラデーションを表示。
    - 列挙表示：通常時の表示切り替え機能。カード内に含まれる`Text`セルと`Task`セルのタイトルを縦に並べて表示する。並びはカード内のセルのソート順に従う。
  - 展開（Expanded）：ツールバー、セルリスト、FABを表示。背景が強調され、リングが表示される。
  - 除外（Removed）：`remove`設定ありの場合、背景色を変更しプレビューテキストを打ち消し線・透過表示にする。
  
**挙動**：300msのトランジション（transition-all）。通常時のクリックで展開、Escキーまたは閉じるボタンで折りたたみ。除外時はクリック不可（cursor-default）。

# カードツールバー
**名称**：カードツールバー
**種類**：操作ツール群
**用途**：カード内のセルのソート条件および並べ替え状態の制御。
**形状**：角丸（rounded-lg）、ボタンは角丸（rounded）。
**寸法**：高さ 28px、ボタン 24x24px、アイコン 20x20px。パディング 4px(px-1)。
**文字**：ソートの詳細ラベル（OLD/NEW）は極小（10px）。
**色彩**：
  - 背景：bg-white/5（backdrop-blur-sm）。
  - ボタン（アクティブ）：bg-white/20、文字色：白（text-white）。
  - ボタン（非アクティブ）：文字色：透過白（text-white/50）、hover:bg-white/10。
**装飾**：バックドロップブラ―（backdrop-blur-sm）。
**配置**：展開時のカード内右上に配置。アイコン間隔 4px（gap-1）。
**状態**：
  - 手動並べ替え：有効時にボタン背景が強調。
  - ソート有効：各ソートボタンの背景が強調。
**挙動**：
  - 手動並べ替えボタン：有効/無効を切り替え。
  - タスクソートボタン：無効、未完了優先、完了優先をトグル。
  - 制作時間ソートボタン：無効（×印）、古い順（OLD）、新しい順（NEW）をトグル。

# セル追加ボタン (Card FAB)
**名称**：セル追加ボタン (Card FAB)
**種類**：フローティングボタン
**用途**：カード内へのセルの新規追加。
**形状**：正円（rounded-full）。
**寸法**：60x60px、アイコン 28px。
**文字**：なし。
**色彩**：背景 紫色（bg-purple-600）、アイコン白色。
**装飾**：白色のシャドウ（shadow-[0_0_15px_rgba(255,255,255,0.4)]）。
**配置**：カード内右下（bottom 16px, right 16px）。
**状態**：
  - アクティブ：タップ中（active:scale-95）。
  - メニュー展開：プラスアイコンが45度回転。
**挙動**：
  - **短押し (Tap/Short Press)**: デフォルトの `Text` 属性セルを追加。
  - **長押し (Long Press)**: 10ms以上の維持でパイメニューを表示。

# 属性選択メニュー (Pie Menu)
**名称**：属性選択メニュー (Pie Menu)
**種類**：コンテキスト項目
**用途**：セルの属性を選択して生成。
**形状**：角丸四角形（rounded-xl）。
**寸法**：48x48px (w-12 h-12)、アイコン 24px。
**文字**：なし。
**色彩**：背景 紫色（bg-purple-600）、アイコン白色。
**装飾**：シャドウ（shadow-md）。ホバー時にスケール 1.1倍、リング（ring-2 ring-white/50）で強調。
**配置**：
  - **Task**: ボタンの上側（bottom-16）。
  - **Text**: ボタンの左側（right-16）。
**状態**：ホバー/選択状態で視覚的に強調。
**挙動**：項目上でマウスアップ（離す）すると、該当属性のセルを追加。

# ロジック
## レア度算出
- カードに含まれる子要素セルのレア度平均（1.0=Rare, 0.0=Common）を使用。
- `Time` セルは計算から除外。
- すべて Time セルの場合、または子要素がない場合はデフォルトの 1.0 を使用。

## タイトル決定
- カード内セルのうち、`Time` 属性以外の最初のセルの名称（`N`）をタイトルのデフォルトとして表示。

## カードの自動初期化
- 新規作成時に `Time Cell`（作成時刻）とデフォルトの `Text Cell`（空）を自動的に追加する。

## スクロール挙動 (Card List連動)
- カード展開時、リストは対象のカードが最上部に来るようにスムーズスクロールを行う。
- スクロール位置は `UIStateContext` を通じてヘッダー・フッターの表示制御に利用される。
