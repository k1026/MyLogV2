# 5. カードUI (Card UI)

カードはユーザーのデータ操作の基本単位であり、複数のCellを束ねるコンテナとして機能します。

## 5.1 カード本体 (Card Container)

**名称**：カード本体
**種類**：コンテナ
**用途**：複数のセルを統合し、リレーションの基本単位として機能。展開・折りたたみによる情報整理。
**形状**：巨大な角丸（rounded-3xl）、枠線あり（border）、インライン展開。
**寸法**：パディング 12px、幅は画面または親コンテナに追従。
**文字**：タイトル（折りたたみ時）はボールド・大（text-lg）、生成日時は小（text-xs）。
**色彩**：
  - 背景：レア度平均（0.0〜1.0）に基づく線形グラデーション（135deg）。
  - レア度算出：含まれる子要素セルのレア度平均（1.0=Rare, 0.0=Common）。Timeセルは計算から除外。
  - レア度1.0の基本色：開始 #667eea、終了 #764ba2。
  - レア度0.0の場合、基本色の60%濃度（白とブレンド）を使用。
  - 状態重畳：折りたたみ時は bg-white/5、展開時は bg-white/10。
**装飾**：シャドウ（shadow-sm）。展開時はバックドロップブラ―（backdrop-blur-md）とリング（ring-2 ring-white/20）を適用。
**配置**：縦並び（flex-col）。折りたたみ時はタイトルと生成日時を両端に配置。
**状態**：
  - 折りたたみ（Collapsed）：タイトル、生成日時、レア度背景を表示。クリックで展開。
  - 展開（Expanded）：ツールバー、セルリスト、FABを表示。背景が強調され、Escキーまたは閉じるボタンで折りたたみ。
  - 除外（Removed）：`remove`設定ありの場合、薄いグレー背景に設定しプレビューテキストを打ち消し線で表示。
**挙動**：300msのトランジション（transition-all）。展開はインラインで行われ、画面遷移を伴わない。

### 5.1.1 基本構成と初期化
- **ID**: Cardセルの`id`を使用
- **Value**: 含まれるCellの`id`のリスト（スペース区切り）
- **初期生成**: 新規作成時に `Time Cell`（作成時刻）とデフォルトの `Text Cell`（空）を自動追加し、1ms間隔でIDを生成する。

## 5.2 カードツールバー (Card Toolbar)

**名称**：カードツールバー
**種類**：ツール群
**用途**：カード内のセルのソート条件および並べ替え状態の制御。
**形状**：角丸（rounded-lg）、ボタンは角丸（rounded）。
**寸法**：高さ 28px、ボタン 24x24px、アイコン 20x20px。パディング 4px。
**文字**：ソートの詳細ラベル（OLD/NEW等）は極小（10px）。
**色彩**：背景 bg-white/5、アクティブなボタンは bg-white/20。文字は基本透過白（text-white/50）、アクティブ時は白（text-white）。
**装飾**：バックドロップブラ―（backdrop-blur-sm）。
**配置**：展開時のカード内右上に配置。アイコン間隔 4px（gap-1）。
**状態**：
  - 手動並べ替え：有効時に青白く発光、生成時間/タスクソートを無効化。
  - ソート有効：アイコンの透過度が上がり不透明に。
**挙動**：
  - **閉じるボタン**: 右端に配置。白地20%の丸いアイコン。Escキーでも動作。
  - **生成時間ソート**: 無効（×印）、古い順（OLD）、新しい順（NEW）をトグル。
  - **タスクソート**: 無効、未完了優先、完了優先をトグル。
  - **手動並べ替え**: 有効時、セルUIを長押しドラッグで順序変更可能。`Card`セルの`value`を直接書き換える。

## 5.3 セル追加ボタン (Card FAB)

**名称**：セル追加ボタン (CardFAB)
**種類**：フローティングボタン
**用途**：カード内へのセル（Text/Task属性）の新規追加。
**形状**：正円（rounded-full）。
**寸法**：60x60px、アイコン 28px。
**文字**：なし。
**色彩**：背景 薄紫色（bg-purple-200）、アイコン白色。
**装飾**：シャドウ（shadow-lg）。
**配置**：カード内右下（bottom 16px, right 16px）。
**状態**：
  - アクティブ：タップ中（active:scale-95）。
  - メニュー展開：プラスアイコンが45度回転。
**挙動**：
  - **単押し (Tap/Short Press)**: デフォルトの `Text` 属性セルを追加。
  - **長押し (Long Press)**: 10ms以上の維持でパイメニューを表示。
  - **フォーカス**: 追加したセルのタイトルに自動フォーカスし全選択。

## 5.4 パイメニュー項目 (Pie Menu Item)

**名称**：属性選択メニュー
**種類**：コンテキスト項目
**用途**：セルの属性を選択して生成。
**形状**：角丸四角形（rounded-xl）。
**寸法**：48x48px (w-12 h-12)、アイコン 24px。
**文字**：なし。
**色彩**：背景 薄紫色（bg-purple-200）、アイコン白色。
**装飾**：シャドウ（shadow-md）。ホバー時にスケール 1.1倍、リング（ring-2 ring-white/50）で強調。
**配置**：
  - **Task**: ボタンの上側（bottom-16）。
  - **Text**: ボタンの左側（right-16）。
**状態**：ホバー/選択状態で視覚的に強調。
**挙動**：ドラッグして項目上で離すと該当属性のセルを追加。何も選択せず離すとメニューを閉じる（デフォルト属性追加はしない）。

## 5.5 カードリスト (Card List)

**名称**：カードリスト
**種類**：コレクションビュー
**用途**：カードを時系列またはソート条件に従って一覧表示。仮想スクロールによる大量データ処理。
**形状**：スクロール可能なコンテナ。
**寸法**：
  - 上部余白 (Header用): 64px (pt-[64px])
  - 下部余白 (Footer用): 80px (pb-[80px])
  - グリッド間隔: 16px (gap-4)
  - パディング: 16px (p-4)
**色彩**：透明のスクロールコンテナ。
**配置**：
  - リストモード: 1列表示 (grid-cols-1)
  - グリッドモード: 2列表示 (grid-cols-2)
**挙動**：
  - 仮想スクロール: 上下30アイテム（計90アイテム前後）をウィンドウとして保持し、描画負荷を軽減。
  - スクロールクランプ: カード展開時、カードの上端がヘッダー下端、または下端がフッター上端を超えないようにスクロール範囲を制限。

## 5.6 パフォーマンス
- **仮想スクロール (Virtual Scroll)**:
  - 大量のログをスムーズに表示するため、画面内に見える範囲のカードのみを描画。
  - アイコン等の静的アセットは読み込み済みとし、スクロール時の再計算を避ける設計。

