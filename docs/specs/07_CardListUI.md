# 7. カードリストUI (Card List UI)

カードリストUIは、アプリケーションのメインビューであり、データベース内のCardセルを一覧表示するためのUI

# レイアウト
- **[全体]**：垂直
  - **[中央]**：垂直
    - **[リストコンテナ]**：垂直
      - **[上部スペーサー]**：垂直
      - **[グリッド]**：グリッド
        - **[カードラッパー]**：垂直
          - 🃏 カード
      - **[下部スペーサー]**：垂直
  - **[右下]**：固定
    - ➕ **[カード追加ボタン]**

## 共通仕様
**名称**：
**種類**：
**用途**：
**形状**：
**寸法**：
**文字**：
**色彩**：
**装飾**：
**配置**：
**状態**：
**挙動**：

## リストコンテナ
**名称**：リストコンテナ
**種類**：コンテナ
**用途**：カード一覧の表示、スクロール制御
**形状**：矩形
**寸法**：幅100%、高さ100%
**文字**：
**色彩**：
**装飾**：
**配置**：[中央]、padding-top: 64px, padding-bottom: 80px (ヘッダー・フッター回避)
**状態**：
**挙動**：Y軸スクロール (smooth)、overflow-y-auto

## カードリスト配置
**名称**：カードリスト
**種類**：レイアウトコンテナ
**用途**：カードの配置
**形状**：
**寸法**：
**文字**：
**色彩**：
**装飾**：
**配置**：[リストコンテナ]内、padding: 16px (px-4), gap: 16px (mb-4)
**状態**：垂直リスト表示（1カラム）
**挙動**：

## カードラッパー
**名称**：カードラッパー
**種類**：ラッパー
**用途**：個々のカードの配置、展開時のZ軸制御
**形状**：
**寸法**：
**文字**：
**色彩**：
**装飾**：transition-all duration-500
**配置**：[グリッド]内
**状態**：通常時 z-index: 0、展開時 z-index: 50
**挙動**：

## カード追加ボタン
**名称**：カード追加ボタン (FAB)
**種類**：フローティングアクションボタン
**用途**：新規カードの作成
**形状**：角丸正方形 (rounded-xl)
**寸法**：56px x 56px (w-14 h-14)
**文字**：
**色彩**：背景色：白 (bg-white)、アイコン色：紫 (text-purple-600)
**装飾**：シャドウ (shadow-lg)
**配置**：
  - [右下]
  - 右端から32px (right-8)
  - 下端からの距離：
    - フッター表示時：104px (bottom-[104px])
    - フッター非表示時：32px (bottom-8)
  - Z-Index: 100
**状態**：ホバー時拡大 (scale-105)、アクティブ時縮小 (scale-95)
**挙動**：
  - トランジション：transition-all duration-300
  - 表示制御：`visible`プロパティにより制御（リスト内のカード展開時は非表示）

# データソース
- **データソース**：IndexedDBから取得したCell配列（`attribute`=`Card`）
- **フィルタリング**：上位コンポーネントまたはフックによりフィルタリング済みのデータを`cards`プロパティとして受け取る

# インタラクション
- **スクロール**：
  - `react-virtuoso` 等のライブラリを使用した仮想スクロールにより、数千件のデータでも高速なレンダリングを実現
  - カード展開によってアイテムの高さが動的に変化する場合も、自動的に再計算を行い表示ずれを防ぐ
  - スクロールイベントを検知し、UI状態（ヘッダー・フッターの表示）を同期
- **カード展開 (Expand)**：
  - 該当カードIDを`expandedCardId`として状態管理
  - **【スクロール】**：展開時、対象カードの上端がリスト表示領域の上端に来るようにスムーズスクロール (`scrollToIndex`)
  - フォーカスイベント (`onFocus`) を発火
- **カード折りたたみ (Collapse)**：
  - `expandedCardId`をクリア
  - **【スクロール】**：折りたたみ時は画面移動（スクロール）を行わない
  - フォーカス解除イベント (`onFocusClear`) を発火
- **カード追加 (Add)**：
  - 新規作成されたカードにフォーカス設定
  - **【スクロール】**：追加されたカードの位置までスムーズにスクロールする


# パフォーマンス最適化

## 仮想スクロール (Virtual Scroll)
- **ライブラリ**：`react-virtuoso` (推奨)
- **設定**：
  - **リスト表示**：通常の縦スクロール（グリッドモードは廃止）
  - **動的高さ対応**：カードの展開/折りたたみによる高さの変化を検知し、スクロール位置とレンダリング範囲を適切に維持する
- **ロジック**：
  - CSSの `scroll-smooth` は仮想スクロールと競合するため使用しない
  - `CardList` コンテナ（または `Window`）のスクロールイベントを `UIStateContext` に伝搬し、ヘッダー/フッターの表示/非表示を通常通り制御する
  - 展開されたカードがヘッダーと重なる場合は、Z-Index調整で対応する

