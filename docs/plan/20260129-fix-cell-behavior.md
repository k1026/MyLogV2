# 不具合修正計画：セルUIの挙動安定化

## 1. 概要
`TaskCell`において、ユーザーの入力が非同期のタイトル推定処理によって上書きされる不具合、および`Card`コンポーネントにおけるレンダリング効率の問題を修正し、UIの安定性を向上させる。

## 2. 現状の問題点
1.  **入力消失・上書き (TaskCell)**: セル追加直後にユーザーが入力を開始しても、非同期の`estimate()`処理完了時に「処理開始時の状態（空文字）」に基づいて判定が行われ、入力内容が推定タイトルで強制的に上書きされる。
2.  **不要なインスタンス生成 (Card)**: `Card`コンポーネントのレンダリングループ内で、描画のたびに`new Cell()`が実行されており、パフォーマンスとReactの最適化に悪影響を与えている。

## 3. 要件定義

### 3.1 TaskCellの競合状態解消
- `useCellTitleEstimation`の処理完了時に、**現在の**入力値（`name`）を確認する。
- ユーザーが既に入力を開始している（`name`が空でない、または変更されている）場合は、自動入力をスキップする。
- 推定候補（`TitleCandidates`）の表示は維持し、ユーザーが選択できるようにする。

### 3.2 Cardコンポーネントの最適化
- 子セルのレンダリング時に`new Cell()`を毎回実行せず、データが変更された場合のみ再生成するように`useMemo`等でメモ化する。

## 4. 実装計画

### Phase 1: TaskCellの修正 (優先度: 高)
- **対象ファイル**: `app/components/cell/TaskCell.tsx`
- **手順**:
    1.  `useState`のsetter（関数型アップデート）を利用するか、`useRef`を使用して、非同期コールバック内で「最新のname」を参照できるようにする。
    2.  `estimate().then(...)`内のロジックを修正し、`name`が空の場合のみセットするように変更する。

### Phase 2: Cardレンダリングの最適化
- **対象ファイル**: `app/components/card/Card.tsx`
- **手順**:
    1.  `renderCell`関数内の`new Cell(...)`生成ロジックを見直し、`useMemo`を使用して`childCells`の変更時のみインスタンスを再生成するように修正する、または`map`内で直接生成する場合も不必要な再描画を防ぐ構造にする。

## 5. テスト計画
- 既存のテスト(`TaskCell.test.tsx`, `Card.test.tsx`)を実行し、リグレッションがないことを確認する。
- 競合状態はユニットテストでの再現が難しいため、手動確認（Addボタン押下直後に高速入力）を行い挙動を検証する。
