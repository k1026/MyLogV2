---
name: cord-guideline
description: コードレビューの基準を説明するスキル。環境に依存せず広く使用できるものです。
---

## 目的
プロジェクト内のコードは、AIによるコード解釈性、保守性、およびトークン効率（コンテキスト最適化）を最大化することを優先する。

## 1. 設計原則 (Core Principles)

* **厳格な型定義 (Strict Typing)**
    * すべてのデータ構造に型を定義する。動的型付け言語であってもスキーマバリデーション（Zod, Pydantic, Marshmallow等）を導入し、**Single Source of Truth (信頼できる唯一の情報源)** とする。
    * 型定義の回避（`any` や `Unknown` キャストの乱用）は原則禁止。
* **文脈の独立性 (Context Autonomy)**
    * ファイルは高い独立性を保ち、依存関係を明示する。
    * **バレルファイル（indexファイルによる一括エクスポート）は原則禁止。** AIが必要なモジュールのみを最小限のコンテキストで読み取れるように設計する。
* **トークン効率の最適化 (Token Efficiency)**
    * **1ファイル 100〜200行**を目安に分割する。巨大なファイルはAIのハルシネーションを誘発するため、関心の分離を徹底する。
    * 不要なコメント、デッドコード、過度な装飾ラインを排除し、AIの読み取り効率を最大化する。

---

## 2. 実装プロセス (Implementation Process)

* **インターフェース・ファースト**
    * 複雑なロジックを実装する前に、関数のシグネチャとドキュメンテーション（JSDoc/Docstring等）を定義する。AIが「結合部分」を先に理解することで、生成コードの精度を向上させる。
* **意味論的コメント (Why/Context指向)**
    * 「何をしているか（What）」はコードそのもので表現し、**「なぜその設計にしたか（Why/Context）」**をコメントに残す。
* **影響範囲の事前確認**
    * 破壊的な変更を行う前には、必ずプロジェクト全域の参照状況（grepやLSPの参照検索）を確認し、AIに影響範囲を提示する。

---

## 3. 推奨ディレクトリ構造（責務分離）

環境に依存せず、以下のカテゴリでコードを整理する。

| カテゴリ | 内容・役割 |
| :--- | :--- |
| **Entry/Routes** | アプリケーションのエントリポイント、ルーティング定義。 |
| **Components/UI** | 再利用可能な最小単位のUI部品、またはプレゼンテーション層。 |
| **Features/Domain** | 特定の機能・ビジネスロジックに基づいたモジュール（コロケーション推奨）。 |
| **Core/Lib** | 全体で共有する基盤ロジック、ユーティリティ、型定義、クライアント設定。 |
| **Docs/Specs** | 仕様書、設計指針、AI用のコンテキストドキュメント。 |

---

## 4. 品質保証とエラーハンドリング

* **ロジックの単体テスト**
    * 外部環境（DB、ネットワーク、ファイルシステム）に依存しない純粋なロジックを分離し、優先的に単体テストを記述する。
* **モックの活用**
    * 外部依存との境界は必ずインターフェース化し、テスト時はモックを使用することで環境依存の不安定なテストを排除する。
* **階層的なフィードバック**
    * **ユーザー向け:** 穏便なメッセージと適切なUIフィードバック（トースト、エラー画面等）。
    * **システム/AI向け:** 詳細なスタックトレース、コンテキスト情報、エラーコードのログ出力。

---

## 5. 運用制約

* **静的解析の厳守**
    * プロジェクト固有のLint/Formatterの設定を絶対とし、AIによる独自のスタイル適用を禁止する。
* **パスの明示**
    * 修正提案や議論の際は、常にプロジェクトルートからの相対パス（例: `src/features/auth/api.ts`）を特定して提示する。
* **非破壊的修正**
    * JSX/HTMLなどの構造を破壊するリスクがあるため、正規表現等を用いた機械的な一括置換（SED等）は避け、論理的なコード修正を行う。