---
name: test-guideline
description: テストコード作成のガイドラインを提供します。テスト環境やテストコマンドは実施環境に応じて対応してください。
---

# 目的 (Goal)
テストコードの問題を発見、修正し最適化することで堅牢かつ効率的なテスト環境を維持すること。

# 対象
全てのテスト。

# テスト実行のルール
・テストの実行はテストファイル単位の実行を基本とする(負荷軽減)
・必要な場合は複数のテストファイルや全テストを同時に実行してよい
・必要な場合はテストログをファイルに出力してよいが、テストログは必要最小限に抑え効率化を図ること
・テスト全体のパフォーマンスやボトルネックを特定する場合は全体テストを実行しテストログを確認すること

# テストの実装方針

- テストの実装においても `.agent\skills\SAT-DD\Review\code-guideline\SKILL.md`のコーディングガイドラインを遵守すること。

- テスト実装においては常に実行効率を意識し、最小のテストで最大の効果を目標にすること。必要に応じて追加、修正、削除を行いテストを整理して良い。

- **テストファースト**での実装時は、コード実装ファイル（.ts,.tsx）に関数名と型定義のみの「空実装」を作成すること。

- 以下を全てのテストに共通する**基本方針**とする
  - テスト対象のコードに対して公開されているインターフェース経由で論理検証により「振る舞いの検証」を行うこと
  - 意図的な「空実装」の実装コードに対しては「空実装」に対しては必ず「失敗（Red）」する論理構造であること
  - 実装コードに対して十分なテストパターンを網羅させること
  - 単体テストに比重を置き、テストの独立性を高めること
  - 外部ではなくプロジェクト内部のビジネスロジックに焦点を当ててテストすること
  - 公開されているインターフェースを通じて振る舞いをテストすること
  - 外部依存の処理はモック化し効率化を測ること
  - 不要なDB接続は避け、必要に応じてインメモリのオブジェクトなどで代用すること
  - 最適化はボトルネックとなっている箇所から優先的に取り組むこと
  - テスト一つの実行速度は10ms以下を目標とすること

- **ビジネスロジックのテスト**は以下の方針をに従うこと
  - テスト間で状態を共有せず、高速に並列実行できる構成を維持すること
  - テストパターンは、最小値(min)、最大値(max)、無効値(null/empty)などの境界値で網羅的に行い、`if/else` のすべての分岐を最小限のケースで通るように整理すること
  - 同じ操作を繰り返しても副作用がないか確認すること
  - DB操作は全て `await` を徹底し、`beforeEach` でのテーブルクリアを含めること
    
- **UIコンポーネントのテスト**は以下の方針をに従うこと
  - 文字のサイズや太さ、要素の形状、色彩、透過度、階層、配置、余白などの各パラメータが、仕様に準拠しているか確認するテストを作成する
  - クラス名などの「宣言的検証」と、最終出力値やインラインスタイルによる「実測的検証」を併用する。
  - 標準的な意匠に対しては属性の確認で精度と速度を両立する。
  - 操作やデータ状況の変化に伴う視覚的フィードバックを確認する。フォーカス等の変化に加え、完了・未完了やエラー等の論理ステータスに紐づく外観の変化が、設計通りに切り替わるか、その動的な整合性を適時保証する。
