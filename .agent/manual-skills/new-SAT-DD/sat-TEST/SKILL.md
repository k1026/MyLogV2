---
name: test-guideline
description: テストコードの作成、修正、最適化、削除を行うためのガイドラインを提供します。
---

# 目的 (Goal)
テストコードの問題を発見、修正し最適化することで堅牢かつ効率的なテスト環境を維持すること。

# 対象
全てのテスト。


# ツール
・基本的には `npm run test` コマンドでテストを実行し、そのログを利用する。
・必要な場合は `npm run test:full-log` コマンドで全テストを実行し、`test-full.log` ファイルを確認することでテスト全体のパフォーマンスやボトルネックを特定する。

# テストの実装方針

0. テストの実装においても `C:\tojiro\programming\AG\MyLogV2\.agent\skills\guideline\SKILL.md`を読みガイドラインを遵守すること

1. 必要に応じて既存のテストの修正、削除を行って良い

2. 以下を全てのテストに共通する**基本方針**とする
  - 実装コードに対して十分なテストパターンを網羅させる
  - 単体テストに比重を置き、テストの独立性を高めること
  - 外部ではなくプロジェクト内部のビジネスロジックに焦点を当ててテストする
  - 公開されているインターフェースを通じて振る舞いをテストする
  - 外部依存の処理はモック化し効率化を測る
  - 不要なDB接続は避け、必要に応じてインメモリのオブジェクトなどで代用する
  - 最適化はボトルネックとなっている箇所から優先的に取り組む
  - テスト一つの実行速度は10ms以下を目標とする

3. **ビジネスロジックのテスト**は以下の方針をに従うこと
  - テスト間で状態を共有せず、高速に並列実行できる構成を維持すること
  - テストパターンは、最小値(min)、最大値(max)、無効値(null/empty)などの境界値で網羅的に行い、`if/else` のすべての分岐を最小限のケースで通るように整理すること
  - 同じ操作を繰り返しても副作用がないか確認すること
  - DB操作は全て `await` を徹底し、`beforeEach` でのテーブルクリアを含めること
    
4. **UIコンポーネントのテスト**は以下の方針をに従うこと
  - 文字のサイズや太さ、要素の形状、色彩、透過度、階層、配置、余白などの各パラメータが、仕様に準拠しているか確認するテストを作成する
  - クラス名などの「宣言的検証」と、最終出力値やインラインスタイルによる「実測的検証」を併用する。
  - 標準的な意匠に対しては属性の確認で精度と速度を両立する。
  - 操作やデータ状況の変化に伴う視覚的フィードバックを確認する。フォーカス等の変化に加え、完了・未完了やエラー等の論理ステータスに紐づく外観の変化が、設計通りに切り替わるか、その動的な整合性を適時保証する。


