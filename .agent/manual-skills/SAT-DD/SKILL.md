---
name: light-sat-dd
description: 新規実装、リファクタリング、フォルダ構成変更、仕様変更、バグ修正など、コードに変更を加える全てのタスクで遵守すべきプロセスを提供します。
---

**このスキルは明示的に指示されない限り使用しないこと**

# 目的 (Goal)
コードの安定性を保ちプロジェクトの品質を保証すること。

# ルールと制約 (Rules & Constraints)
- テストファイルは実装コードと同じフォルダに作成すること。
- 大きなタスクを処理する場合は実装精度を維持する観点からステップに分解し個別に本スキルを実行することをユーザーに提案し承認を得ること。
- 必要な場合は`docs/specs/`内の関連する仕様書を参照すること

# 実装ワークフロー

## Step 1: 選択
- 新規実装、または既存機能の外部から見た振る舞いが変わる修正の場合は**Step 2** のテストの作成に進む。振る舞いを変えない内部最適化・リファクタリングの場合は**Step 4**の実装に進む。

## Step 2: テスト作成

0. 既存の機能の修正の場合は必要に応じてテストの修正、削除を行う

1. 下記のルールに従い新しいテストを作成し**Step 3**に進む

    **基本方針**
    - 実装ファイル（.ts,.tsx）に関数名と型定義のみの「空実装」を作成し、テストコードは公開インターフェース経由で論理検証により「振る舞いの検証」を行い、「空実装」に対しては必ず「失敗（Red）」する論理構造であること。

    **ロジックコードのテスト**
    - テスト間で状態を共有せず、高速に並列実行できる構成を維持すること
    - テストパターンは、最小値(min)、最大値(max)、無効値(null/empty)などの境界値で網羅的に行い、`if/else` のすべての分岐を最小限のケースで通るように整理すること
    - 同じ操作を繰り返しても副作用がないか確認すること    
    - DB操作は全て `await` を徹底し、`beforeEach` でのテーブルクリアを含めること
    
    **デザインコードのテスト**
    -文字のサイズや太さ、要素の形状、色彩、透過度、階層、配置、余白などの各パラメータが、仕様に準拠しているか確認する
    -クラス名などの「宣言的検証」と、最終出力値やインラインスタイルによる「実測的検証」を併用する。標準的な意匠は属性の確認で精度と速度を両立する。
    -操作やデータ状況の変化に伴う視覚的フィードバックを確認する。フォーカス等の変化に加え、完了・未完了やエラー等の論理ステータスに紐づく外観の変化が、設計通りに切り替わるか、その動的な整合性を適時保証する。

## Step 3: テスト実行
2.  テストコマンドで必要なテストを実行し、テストログを確認し、**作成した全てのテストが「論理的に失敗（Red）」している**ことを確認する

3. 全てのテストが論理的にエラー(アサーションエラー)になっていれば**Step 4**の実装に進む。そうでない場合は **Step2** のテストの作成からやり直す。

## Step 4: 実装
4. `any` を一切使わず、Strictな型を維持したまま、テストをパスさせるためのコードの実装・修正を実施する。

5.  テストコマンドを実行し、出力されたテストログの内容を確認し全てのテストがパスしたら**Step 5**に進む。テストでエラーが出た場合は 4. の実装に戻る。テスト自体に問題がある場合は**Step 2**のテストの作成に戻って良い。

## Step 5: 最適化と厳格化
6.  **Step 4**で変更したコードに対してコード規約に準拠するように修正し、AIによる可読性や処理効率を最適化する。

7. 実装コードに関連するテストに対して批判的視点で評価し、堅牢性と実施効率を高めるように修正する。必要に応じてテストを追加・削除してよい。

8. テストコマンドでを実行し、出力されたテストログの内容を確認し、全てのテストがパスしたら**Step 6**に進む。テストでエラーが出た場合は 6. に戻る。

## Step 6: 最終確認
9. テストコマンドで既存の全テストを実行しテストログの内容を確認する。エラーが出た場合は軽微なものならばこの段階で修正して良い。それ以外は対処せずに報告対象とする。

10. 変更点と仕様を比較し仕様書を作成・更新する。

11. ユーザーに対し、実装内容と最終的なテスト結果を報告する。実装中に見つかった問題も併せて報告する。
